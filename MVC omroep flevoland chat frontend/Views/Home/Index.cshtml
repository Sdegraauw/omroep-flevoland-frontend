@{
    ViewData["Title"] = "Home Chat";
}

@model API

<div>
    <flowise-fullchatbot></flowise-fullchatbot>
</div>
<head>
    <title>File Searcher</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        .status-icon {
            display: none;
            font-size: 24px;
        }

            .status-icon.success {
                color: green;
            }

            .status-icon.error {
                color: red;
            }
    </style>
</head>
<body>
    <form id="fileUploadForm" method="post" enctype="multipart/form-data">
        <input type="file" id="fileUpload" name="fileUpload" accept=".pdf" />
        <input type="button" id="uploadButton" value="Upload" />
        <span id="uploadSuccess" class="status-icon success">&#10003;</span>
        <span id="uploadError" class="status-icon error">&#10007;</span>
    </form>
    <script>
        document.getElementById('uploadButton').addEventListener('click', async function () {
            let fileInput = document.getElementById('fileUpload');
            let file = fileInput.files[0];
            if (file) {
                console.log("File name:", file.name);
                console.log("File size:", file.size);
                console.log("File type:", file.type);

                let reader = new FileReader();
                reader.onload = function (e) {
                    console.log("File content:", e.target.result);
                };
                reader.readAsText(file);

                let formData = new FormData();
                formData.append("files", file);
                formData.append("returnSourceDocuments", true);

                async function FileUpload(formData) {
                    const response = await fetch(
                        'http://localhost:3000/api/v1/vector/upsert/16ad2af2-ef5b-4560-bdbe-bacf29f73cef',
                        {
                            method: "POST",
                            body: formData
                        }
                    );
                    const result = await response.json();
                    return result;
                }

                FileUpload(formData).then((response) => {
                    console.log(response);
                    document.getElementById('uploadSuccess').style.display = 'inline';
                    document.getElementById('uploadError').style.display = 'none';
                }).catch((error) => {
                    console.error('Error uploading file:', error);
                    document.getElementById('uploadSuccess').style.display = 'none';
                    document.getElementById('uploadError').style.display = 'inline';
                });
            } else {
                console.error("No file selected.");
            }
        });
    </script>
</body>

<script type="module">
    import Chatbot from 'https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js';

    document.addEventListener('DOMContentLoaded', () => {
        let formData = new FormData();
        formData.append("files", document.getElementById('fileUpload').files[0]);
        formData.append("temperature", 1);

        Chatbot.initFull({
            chatflowid: '@Model.FlowID',
            apiHost: '@Model.BaseUrl',
            body: formData,
            theme: {
                button: {
                    backgroundColor: '#bf2133',
                },
                chatWindow: {
                    welcomeMessage: 'hallo, waar kan ik je mee helpen?',
                    backgroundColor: 'floralWhite',
                    height: (screen.height / 1.5),
                    width: (screen.width / 1.5),
                    fontSize: 16,
                    poweredByTextColor: '#303235',
                    botMessage: {
                        backgroundColor: 'floralwhite',
                        textColor: '#303235',
                        showAvatar: false
                    },
                    userMessage: {
                        backgroundColor: '#f9dbdb',
                        textColor: '#303235',
                        showAvatar: false,
                    },
                    textInput: {
                        placeholder: 'Type your question',
                        backgroundColor: '#ffffff',
                        textColor: '#303235',
                        sendButtonColor: '#bf2133',
                    }
                }
            }
        });
    });
</script>
